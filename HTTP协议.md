## HTTP缓存机制

HTTP报文就是浏览器和服务器间通信时发送及响应的数据块

**报文信息主要分为两个部分**

- 包含属性的首部（header）：一般的附加信息，包括cookie、缓存信息等。**与缓存相关的规则信息，均保存在header中** 
- 包含数据的主体部分（body）： HTTP请求真正传输的数据部分



缓存策略的使用就是为了改善客户端的呈现时间，降低服务端的负担。

对于HTTP的缓存机制来说，**缓存策略体现在HTTP的头部信息的字段上**，而这些策略根据是否需要重新向服务器端发起请求，可以分为 **强缓存** 和 **协商缓存**  两大类。

**强缓存：**  与强缓存相关的HTTP header的字段有两个Expires和Cache-Control

- `expires`  规定缓存的资源的过期时间（格林威治时间）。但是时间期限是服务器生成的，与客户端的时间有误差，优先级较低 **HTTP1.0  现在几乎不用**
- `cache-control`  常见的取值有private、public、no-cache、max-age，no-store，默认为private。![8098263-a6938163ec0fa170](C:\Users\Admin\Desktop\summary\8098263-a6938163ec0fa170.png)
- ![强缓存-无缓存](C:\Users\Admin\Desktop\summary\强缓存-无缓存.png)
- ![强缓存-有缓存](C:\Users\Admin\Desktop\summary\强缓存-有缓存.png)

**对比缓存：**  

- ![对比缓存-缓存命中](C:\Users\Admin\Desktop\summary\对比缓存-缓存命中.png)

- ![对比缓存-缓存未命中](C:\Users\Admin\Desktop\summary\对比缓存-缓存未命中.png)

- 对比缓存，需要进行比较判断是否可以使用缓存。
  浏览器第一次请求数据时，服务器会将缓存标识与数据一起返回给客户端，客户端将二者备份至缓存数据库中。
  再次请求数据时，客户端将备份的缓存标识发送给服务器，服务器根据缓存标识进行判断，判断成功后，返回304状态码，通知客户端比较成功，可以使用缓存数据。

  并且**请求的数据大小大大减少，原因是服务器只返回了请求header部分，通过状态码通知客户端使用缓存，不需要将报文主体返回给客户端**



两种缓存机制各有优缺点，**强缓存的优先级高于对比缓存**，两者的区别就是，强缓存在本地缓存库中找到缓存的话就不会再去访问服务器，对比缓存是不管本地有没有缓存都会访问服务器。

**对于强制缓存，服务器通知浏览器一个缓存时间，在缓存时间内，下次请求，直接用缓存，不在时间内，执行比较缓存策略。**

**对于比较缓存，将缓存信息中的Etag和Last-Modified通过请求发送给服务器，由服务器校验，返回304状态码时，浏览器直接使用缓存。**

